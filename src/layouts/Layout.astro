---
import Header from '../components/Header.astro';
import '../styles/components.css';

interface Props {
  title: string;
  description?: string;
  article?: boolean;
}

const {
  title,
  description = 'Independent consultant helping companies ship production AI systems',
  article = false,
} = Astro.props;

const canonicalUrl = new URL(Astro.url.pathname, Astro.site).toString();
const socialImageUrl = new URL('/favicon.png', Astro.site).toString();
---

<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content={description} />

    <title>{title} | Nila</title>
    <link rel="canonical" href={canonicalUrl} />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,500;12..96,600;12..96,700&display=block"
      as="style"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,500;12..96,600;12..96,700&display=block"
      rel="stylesheet"
    />
    <style>
      body {
        opacity: 0;
      }
      body.fonts-loaded {
        opacity: 1;
        transition: opacity 0.1s ease-in;
      }
    </style>
    <script>
      (function () {
        if (document.fonts && document.fonts.ready) {
          document.fonts.ready.then(function () {
            document.body.classList.add('fonts-loaded');
          });
        } else {
          document.body.classList.add('fonts-loaded');
        }
        // Fallback: show page after 1s even if font fails
        setTimeout(function () {
          document.body.classList.add('fonts-loaded');
        }, 1000);
      })();
    </script>

    <!-- Open Graph / Social -->
    <meta property="og:type" content={article ? 'article' : 'website'} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:site_name" content="Nila" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={socialImageUrl} />
    <meta property="og:image:alt" content="Nila logo" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={socialImageUrl} />
  </head>
  <body
    class="flex min-h-full flex-col font-['Bricolage_Grotesque',Arial,sans-serif] text-base"
  >
    <Header />
    <main class="flex flex-grow justify-center pb-16 pt-2">
      <div class="w-full max-w-3xl px-4 text-left sm:px-8">
        <div class="space-y-10">
          <slot />
        </div>
      </div>
    </main>
    <footer class="pb-8 text-center text-xs text-gray-500">
      Â© {new Date().getFullYear()} Nila Labs LLC
    </footer>

    <script>
      (function () {
        const reb2b: Reb2bQueue = (window.reb2b =
          window.reb2b ?? ([] as unknown as Reb2bQueue));
        if (reb2b.invoked) return;
        reb2b.invoked = true;
        reb2b.methods = ['identify', 'collect'];
        reb2b.factory = function (method: string) {
          return function (...args: unknown[]) {
            reb2b.push([method, ...args]);
            return reb2b;
          };
        };
        for (let i = 0; i < reb2b.methods.length; i++) {
          const key = reb2b.methods[i];
          reb2b[key] = reb2b.factory(key);
        }
        reb2b.load = function (key: string) {
          const script = document.createElement('script');
          script.type = 'text/javascript';
          script.async = true;
          script.src =
            'https://s3-us-west-2.amazonaws.com/b2bjsstore/b/' +
            key +
            '/0NW1GH7MZ8O4.js.gz';
          const first = document.getElementsByTagName('script')[0];
          if (first?.parentNode) {
            first.parentNode.insertBefore(script, first);
          } else {
            document.head.appendChild(script);
          }
        };
        reb2b.SNIPPET_VERSION = '1.0.1';
        reb2b.load('0NW1GH7MZ8O4');
      })();
    </script>
  </body>
</html>
